import{d as B,r as k,g as A,p as b,h as W,q as j,w as M,s as V,o as N,c as L,a as w,t as E,x as $,n as F,j as P,F as z,i as Q,y as Z,z as H,_ as J,A as x,B as ee}from"./entry-2ea2ba68.mjs";var te=Object.defineProperty,K=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,q=(e,t,a)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,oe=(e,t)=>{for(var a in t||(t={}))ne.call(t,a)&&q(e,a,t[a]);if(K)for(var a of K(t))ae.call(t,a)&&q(e,a,t[a]);return e};const re={scale:Number,thick:Number,palette:Object,index:Number,start:Number,vertical:Boolean,value:Number,isShowReferLine:Boolean};var I=(e,t)=>{for(const[a,l]of t)e[a]=l;return e};const le=B({name:"LineRuler",props:re,emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:t}){const a=k(0),l=k(!0);A(()=>{a.value=e.value});const c=r=>{l.value=r>=0},i=b(()=>{const r=(a.value-e.start)*e.scale;c(r);const d=r+"px";return e.vertical?{top:d}:{left:d}}),n=b(()=>{var r;const d=`1px solid ${(r=e.palette)==null?void 0:r.lineColor}`,h=e.vertical?{borderTop:d}:{borderLeft:d},f=e.isShowReferLine?e.vertical?"ns-resize":"ew-resize":"none";return oe({cursor:f},h)}),u=b(()=>e.vertical?{left:e.thick+"px"}:{top:e.thick+"px"});return{startValue:a,showLine:l,offset:i,borderCursor:n,actionStyle:u,handleDown:r=>{const d=e.vertical?r.clientY:r.clientX,h=a.value;t("onMouseDown");const f=R=>{const v=e.vertical?R.clientY:R.clientX,m=Math.round(h+(v-d)/e.scale);a.value=m},p=()=>{t("onRelease",a.value,e.index),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",p)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",p)},handleRemove:()=>{t("onRemove",e.index)}}}}),se={class:"value"};function ie(e,t,a,l,c,i){return M((N(),L("div",{class:"line",style:$([e.offset,e.borderCursor]),onMousedown:t[1]||(t[1]=(...n)=>e.handleDown&&e.handleDown(...n))},[w("div",{class:"action",style:$(e.actionStyle)},[w("span",{class:"del",onClick:t[0]||(t[0]=(...n)=>e.handleRemove&&e.handleRemove(...n))},"\xD7"),w("span",se,E(e.startValue),1)],4)],36)),[[V,e.showLine]])}var ce=I(le,[["render",ie],["__scopeId","data-v-069c473f"]]);const ue=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1,U=.83,de=(e,t,a,l,c,i)=>{const{scale:n,width:u,height:s,ratio:o,palette:r}=c,{bgColor:d,fontColor:h,shadowColor:f,longfgColor:p,shortfgColor:R}=r;if(e.scale(o,o),e.clearRect(0,0,u,s),e.fillStyle=d,e.fillRect(0,0,u,s),l){const y=(a-t)*n,S=l*n;e.fillStyle=f,i?e.fillRect(y,0,S,s*3/8):e.fillRect(0,y,u*3/8,S)}const v=ue(n),m=v*n,g=v*10,O=g*n,D=Math.floor(t/v)*v,X=Math.floor(t/g)*g,_=(D-t)/v*m,G=(X-t)/g*O,Y=t+Math.ceil((i?u:s)/n);e.beginPath(),e.fillStyle=h,e.strokeStyle=p;for(let y=X,S=0;y<Y;y+=g,S++){const C=G+S*O+.5;i?e.moveTo(C,0):e.moveTo(0,C),e.save(),i?e.translate(C,s*.4):e.translate(u*.4,C),i||e.rotate(-Math.PI/2),e.scale(U/o,U/o),e.fillText(y.toString(),4*o,7*o),e.restore(),i?e.lineTo(C,s*9/16):e.lineTo(u*9/16,C)}e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=R;for(let y=D,S=0;y<Y;y+=v,S++){const C=_+S*m+.5;i?e.moveTo(C,0):e.moveTo(0,C),y%g!=0&&(i?e.lineTo(C,s*1/4):e.lineTo(u*1/4,C))}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)},he={showIndicator:Boolean,valueNum:Number,scale:Number,ratio:Number,palette:Object,vertical:Boolean,start:Number,width:Number,height:Number,selectStart:Number,selectLength:Number},ve=B({name:"CanvasRuler",props:he,emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:t}){const a=W({canvasContext:null});let l=1;const c=k(null);A(()=>{l=e.ratio||window.devicePixelRatio||1,i(),n(l),u(l)});const i=()=>{a.canvasContext=c.value&&c.value.getContext("2d")},n=o=>{if(c.value){c.value.width=e.width*o,c.value.height=e.height*o;const r=a.canvasContext;r&&(r.font=`${12*o}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,r.lineWidth=1,r.textBaseline="middle")}},u=o=>{const r={scale:e.scale,width:e.width,height:e.height,palette:e.palette,ratio:o};a.canvasContext&&de(a.canvasContext,e.start,e.selectStart,e.selectLength,r,!e.vertical)};return j(()=>e.start,()=>u(l)),j([()=>e.width,()=>e.height],()=>{n(l),u(l)}),{handle:(o,r)=>{const d=(p,R,v)=>Math.round(R+p/v),h=e.vertical?o.offsetY:o.offsetX,f=d(h,e.start,e.scale);switch(r){case"click":t("onAddLine",f);break;case"enter":t("update:valueNum",f),t("update:showIndicator",!0);break;default:t("update:valueNum",f);break}},canvas:c}}});function fe(e,t,a,l,c,i){return N(),L("canvas",{ref:"canvas",class:"ruler",onClick:t[0]||(t[0]=n=>e.handle(n,"click")),onMouseenter:t[1]||(t[1]=n=>e.handle(n,"enter")),onMousemove:t[2]||(t[2]=n=>e.handle(n,"move")),onMouseleave:t[3]||(t[3]=n=>e.$emit("update:showIndicator",!1))},null,544)}var me=I(ve,[["render",fe]]);const we={scale:Number,ratio:Number,thick:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},ge=B({name:"RulerWrapper",components:{CanvasRuler:me,RulerLine:ce},props:we,setup(e){const t=k(!1),a=k(0),l=b(()=>e.vertical?"v-container":"h-container"),c=b(()=>{const o={width:`calc(100% - ${e.thick}px)`,height:`${e.thick+1}px`,left:`${e.thick}px`},r={width:`${e.thick&&e.thick+1}px`,height:`calc(100% - ${e.thick}px)`,top:`${e.thick}px`};return e.vertical?r:o}),i=b(()=>{var o;const r=(a.value-e.start)*e.scale;let d="top",h="borderLeft";return d=e.vertical?"top":"left",h=e.vertical?"borderBottom":"borderLeft",{[d]:r+"px",[h]:`1px solid ${(o=e.palette)==null?void 0:o.lineColor}`}}),n=o=>{e.lines.push(o)},u=(o,r)=>{const d=o-e.start,h=(e.vertical?e.height:e.width)/e.scale;d<0||d>h?s(r):e.lines[r]=o},s=o=>{e.lines.splice(o,1)};return{showIndicator:t,valueNum:a,rwClassName:l,rwStyle:c,indicatorStyle:i,handleNewLine:n,handleLineRelease:u,handleLineRemove:s}}}),Ce={class:"lines"},be={class:"value"};function ye(e,t,a,l,c,i){const n=F("CanvasRuler"),u=F("RulerLine");return N(),L("div",{class:H(e.rwClassName),style:$(e.rwStyle)},[P(n,{vertical:e.vertical,scale:e.scale,width:e.width,height:e.height,start:e.start,ratio:e.ratio,"select-start":e.selectStart,"select-length":e.selectLength,palette:e.palette,valueNum:e.valueNum,"onUpdate:valueNum":t[0]||(t[0]=s=>e.valueNum=s),showIndicator:e.showIndicator,"onUpdate:showIndicator":t[1]||(t[1]=s=>e.showIndicator=s),onOnAddLine:e.handleNewLine},null,8,["vertical","scale","width","height","start","ratio","select-start","select-length","palette","valueNum","showIndicator","onOnAddLine"]),M(w("div",Ce,[(N(!0),L(z,null,Q(e.lines,(s,o)=>(N(),Z(u,{key:s+o,index:o,value:s>>0,scale:e.scale,start:e.start,thick:e.thick,palette:e.palette,vertical:e.vertical,"is-show-refer-line":e.isShowReferLine,onOnRemove:e.handleLineRemove,onOnRelease:e.handleLineRelease},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line","onOnRemove","onOnRelease"]))),128))],512),[[V,e.isShowReferLine]]),M(w("div",{class:"indicator",style:$(e.indicatorStyle)},[w("div",be,E(e.valueNum),1)],4),[[V,e.showIndicator]])],6)}var pe=I(ge,[["render",ye],["__scopeId","data-v-adb71e78"]]);const Re={scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},cornerActive:{type:Boolean,default:!1},isShowReferLine:{type:Boolean,default:!0}},Se=B({name:"SketchRule",components:{RulerWrapper:pe},props:Re,emits:["onCornerClick","handleLine"],setup(e,{emit:t}){const a=b(()=>{function n(s,o){return Object.keys(s).forEach(r=>{r&&s.hasOwnProperty(r)&&(typeof o.key=="object"?s[r]=n(s[r],o[r]):o.hasOwnProperty(r)&&(s[r]=o[r]))}),s}return n({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},e.palette||{})}),l=b(()=>e.cornerActive?" active":""),c=b(()=>({backgroundColor:a.value.bgColor,width:e.thick+"px",height:e.thick+"px",borderRight:`1px solid ${a.value.borderColor}`,borderBottom:`1px solid ${a.value.borderColor}`}));return{paletteCpu:a,cornerActiveClass:l,cornerStyle:c,onCornerClick:n=>{t("onCornerClick",n)}}}}),ke={id:"mb-ruler",class:"style-ruler mb-ruler"};function Ne(e,t,a,l,c,i){const n=F("RulerWrapper");return N(),L("div",ke,[P(n,{vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":e.isShowReferLine,thick:e.thick,ratio:e.ratio,start:e.startX,lines:e.lines.h,"select-start":e.shadow.x,"select-length":e.shadow.width,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),P(n,{vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":e.isShowReferLine,thick:e.thick,ratio:e.ratio,start:e.startY,lines:e.lines.v,"select-start":e.shadow.y,"select-length":e.shadow.height,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),w("a",{class:H(["corner",e.cornerActiveClass]),style:$(e.cornerStyle),onClick:t[0]||(t[0]=(...u)=>e.onCornerClick&&e.onCornerClick(...u))},null,6)])}var T=I(Se,[["render",Ne]]);T.install=e=>{e.component(T.name,T)};const Le=B({setup(e,{expose:t}){t();const a=600,l=320,c=k(null),i=k(null),n=W({scale:2,startX:0,startY:0,lines:{h:[433,588],v:[33,143]},thick:20,isShowRuler:!0,isShowReferLine:!0}),u=b(()=>({x:0,y:0,width:a,height:l})),s=b(()=>({width:a,height:l,transform:`scale(${n.scale})`}));A(()=>{c.value.scrollLeft=i.value.getBoundingClientRect().width/2-400});const o=()=>{const m=document.querySelector("#screens").getBoundingClientRect(),g=document.querySelector("#canvas").getBoundingClientRect(),O=(m.left+n.thick-g.left)/n.scale,D=(m.top+n.thick-g.top)/n.scale;n.startX=O,n.startY=D},r=m=>{if(m.ctrlKey||m.metaKey){m.preventDefault();const g=parseFloat(Math.max(.2,n.scale-m.deltaY/500).toFixed(2));n.scale=g}ee(()=>{o()})},{scale:d,startX:h,startY:f,lines:p,thick:R}=x(n),v={rectWidth:a,rectHeight:l,screensRef:c,containerRef:i,state:n,shadow:u,canvasStyle:s,handleScroll:o,handleWheel:r,scale:d,startX:h,startY:f,lines:p,thick:R,SketchRule:T};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),$e={class:"top"},Be={class:"wrapper"},Oe={ref:"containerRef",class:"screen-container"};function De(e,t,a,l,c,i){return N(),L(z,null,[w("div",$e,"\u7F29\u653E\u6BD4\u4F8B:"+E(l.scale),1),w("div",Be,[P(l.SketchRule,{thick:l.thick,scale:l.scale,width:1380,height:780,"start-x":l.startX,"start-y":l.startY,shadow:l.shadow,lines:l.lines},null,8,["thick","scale","start-x","start-y","shadow","lines"]),w("div",{id:"screens",ref:"screensRef",onWheel:l.handleWheel,onScroll:l.handleScroll},[w("div",Oe,[w("div",{id:"canvas",style:$(l.canvasStyle)},null,4)],512)],544)])],64)}var Ie=J(Le,[["render",De]]);export{Ie as default};
