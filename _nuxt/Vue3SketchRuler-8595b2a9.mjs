import{d as N,r as S,n as Y,p as m,g as F,q as j,w as D,s as I,o as b,c as L,a as p,t as z,x as $,m as A,i as T,F as Z,h as J,y as W,z as H,_,A as x}from"./entry-c1c8225c.mjs";var ee=Object.defineProperty,U=Object.getOwnPropertySymbols,te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,G=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ae=(e,t)=>{for(var n in t||(t={}))te.call(t,n)&&G(e,n,t[n]);if(U)for(var n of U(t))ne.call(t,n)&&G(e,n,t[n]);return e};const oe={scale:Number,thick:Number,palette:Object,index:Number,start:Number,vertical:Boolean,value:Number,isShowReferLine:Boolean};var B=(e,t)=>{for(const[n,l]of t)e[n]=l;return e};const re=N({name:"LineRuler",props:oe,emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:t}){const n=S(0),l=S(!0);Y(()=>{n.value=e.value});const d=s=>{l.value=s>=0},i=m(()=>{const s=(n.value-e.start)*e.scale;d(s);const c=s+"px";return e.vertical?{top:c}:{left:c}}),a=m(()=>{var s;const c=`1px solid ${(s=e.palette)==null?void 0:s.lineColor}`,h=e.vertical?{borderTop:c}:{borderLeft:c},w=e.isShowReferLine?e.vertical?"ns-resize":"ew-resize":"none";return ae({cursor:w},h)}),u=m(()=>e.vertical?{left:e.thick+"px"}:{top:e.thick+"px"});return{startValue:n,showLine:l,offset:i,borderCursor:a,actionStyle:u,handleDown:s=>{const c=e.vertical?s.clientY:s.clientX,h=n.value;t("onMouseDown");const w=k=>{const C=e.vertical?k.clientY:k.clientX,O=Math.round(h+(C-c)/e.scale);n.value=O},y=()=>{t("onRelease",n.value,e.index),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",y)};document.addEventListener("mousemove",w),document.addEventListener("mouseup",y)},handleRemove:()=>{t("onRemove",e.index)}}}}),le={class:"value"};function se(e,t,n,l,d,i){return D((b(),L("div",{class:"line",style:$([e.offset,e.borderCursor]),onMousedown:t[1]||(t[1]=(...a)=>e.handleDown&&e.handleDown(...a))},[p("div",{class:"action",style:$(e.actionStyle)},[p("span",{class:"del",onClick:t[0]||(t[0]=(...a)=>e.handleRemove&&e.handleRemove(...a))},"\xD7"),p("span",le,z(e.startValue),1)],4)],36)),[[I,e.showLine]])}var ie=B(re,[["render",se],["__scopeId","data-v-53789ba1"]]);const ue=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1,K=.83,ce=(e,t,n,l,d,i)=>{const{scale:a,width:u,height:o,ratio:r,palette:s}=d,{bgColor:c,fontColor:h,shadowColor:w,longfgColor:y,shortfgColor:k}=s;if(e.scale(r,r),e.clearRect(0,0,u,o),e.fillStyle=c,e.fillRect(0,0,u,o),l){const v=(n-t)*a,g=l*a;e.fillStyle=w,i?e.fillRect(v,0,g,o*3/8):e.fillRect(0,v,u*3/8,g)}const C=ue(a),O=C*a,R=C*10,M=R*a,V=Math.floor(t/C)*C,E=Math.floor(t/R)*R,q=(V-t)/C*O,Q=(E-t)/R*M,X=t+Math.ceil((i?u:o)/a);e.beginPath(),e.fillStyle=h,e.strokeStyle=y;for(let v=E,g=0;v<X;v+=R,g++){const f=Q+g*M+.5;i?e.moveTo(f,0):e.moveTo(0,f),e.save(),i?e.translate(f,o*.4):e.translate(u*.4,f),i||e.rotate(-Math.PI/2),e.scale(K/r,K/r),e.fillText(v.toString(),4*r,7*r),e.restore(),i?e.lineTo(f,o*9/16):e.lineTo(u*9/16,f)}e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=k;for(let v=V,g=0;v<X;v+=C,g++){const f=q+g*O+.5;i?e.moveTo(f,0):e.moveTo(0,f),v%R!=0&&(i?e.lineTo(f,o*1/4):e.lineTo(u*1/4,f))}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)},de={showIndicator:Boolean,valueNum:Number,scale:Number,ratio:Number,palette:Object,vertical:Boolean,start:Number,width:Number,height:Number,selectStart:Number,selectLength:Number},he=N({name:"CanvasRuler",props:de,emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:t}){const n=F({canvasContext:null}),l=S(null);Y(()=>{d(),i(),a()});const d=()=>{n.canvasContext=l.value&&l.value.getContext("2d")},i=()=>{if(l.value){const o=e.ratio;l.value.width=e.width*o,l.value.height=e.height*o;const r=n.canvasContext;r&&(r.font=`${12*o}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,r.lineWidth=1,r.textBaseline="middle")}},a=()=>{const o={scale:e.scale,width:e.width,height:e.height,palette:e.palette,ratio:e.ratio};n.canvasContext&&ce(n.canvasContext,e.start,e.selectStart,e.selectLength,o,!e.vertical)};return j(()=>e.start,()=>a()),j([()=>e.width,()=>e.height],()=>{i(),a()}),{handle:(o,r)=>{const s=(w,y,k)=>Math.round(y+w/k),c=e.vertical?o.offsetY:o.offsetX,h=s(c,e.start,e.scale);switch(r){case"click":t("onAddLine",h);break;case"enter":t("update:valueNum",h),t("update:showIndicator",!0);break;default:t("update:valueNum",h);break}},canvas:l}}});function fe(e,t,n,l,d,i){return b(),L("canvas",{ref:"canvas",class:"ruler",onClick:t[0]||(t[0]=a=>e.handle(a,"click")),onMouseenter:t[1]||(t[1]=a=>e.handle(a,"enter")),onMousemove:t[2]||(t[2]=a=>e.handle(a,"move")),onMouseleave:t[3]||(t[3]=a=>e.$emit("update:showIndicator",!1))},null,544)}var ve=B(he,[["render",fe]]);const me={scale:Number,ratio:Number,thick:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},we=N({name:"RulerWrapper",components:{CanvasRuler:ve,RulerLine:ie},props:me,setup(e){const t=S(!1),n=S(0),l=m(()=>e.vertical?"v-container":"h-container"),d=m(()=>{const r={width:`calc(100% - ${e.thick}px)`,height:`${e.thick+1}px`,left:`${e.thick}px`},s={width:`${e.thick&&e.thick+1}px`,height:`calc(100% - ${e.thick}px)`,top:`${e.thick}px`};return e.vertical?s:r}),i=m(()=>{var r;const s=(n.value-e.start)*e.scale;let c="top",h="borderLeft";return c=e.vertical?"top":"left",h=e.vertical?"borderBottom":"borderLeft",{[c]:s+"px",[h]:`1px solid ${(r=e.palette)==null?void 0:r.lineColor}`}}),a=r=>{e.lines.push(r)},u=(r,s)=>{const c=r-e.start,h=(e.vertical?e.height:e.width)/e.scale;c<0||c>h?o(s):e.lines[s]=r},o=r=>{e.lines.splice(r,1)};return{showIndicator:t,valueNum:n,rwClassName:l,rwStyle:d,indicatorStyle:i,handleNewLine:a,handleLineRelease:u,handleLineRemove:o}}}),Ce={class:"lines"},ge={class:"value"};function be(e,t,n,l,d,i){const a=A("CanvasRuler"),u=A("RulerLine");return b(),L("div",{class:H(e.rwClassName),style:$(e.rwStyle)},[T(a,{vertical:e.vertical,scale:e.scale,width:e.width,height:e.height,start:e.start,ratio:e.ratio,"select-start":e.selectStart,"select-length":e.selectLength,palette:e.palette,valueNum:e.valueNum,"onUpdate:valueNum":t[0]||(t[0]=o=>e.valueNum=o),showIndicator:e.showIndicator,"onUpdate:showIndicator":t[1]||(t[1]=o=>e.showIndicator=o),onOnAddLine:e.handleNewLine},null,8,["vertical","scale","width","height","start","ratio","select-start","select-length","palette","valueNum","showIndicator","onOnAddLine"]),D(p("div",Ce,[(b(!0),L(Z,null,J(e.lines,(o,r)=>(b(),W(u,{key:o+r,index:r,value:o>>0,scale:e.scale,start:e.start,thick:e.thick,palette:e.palette,vertical:e.vertical,"is-show-refer-line":e.isShowReferLine,onOnRemove:e.handleLineRemove,onOnRelease:e.handleLineRelease},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line","onOnRemove","onOnRelease"]))),128))],512),[[I,e.isShowReferLine]]),D(p("div",{class:"indicator",style:$(e.indicatorStyle)},[p("div",ge,z(e.valueNum),1)],4),[[I,e.showIndicator]])],6)}var pe=B(we,[["render",be],["__scopeId","data-v-6f650e37"]]);const ye={scale:{type:Number,default:1},ratio:{type:Number,default:window.devicePixelRatio||1},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},cornerActive:{type:Boolean,default:!1},isShowReferLine:{type:Boolean,default:!0}},ke=N({name:"SketchRule",components:{RulerWrapper:pe},props:ye,emits:["onCornerClick","handleLine"],setup(e,{emit:t}){const n=m(()=>{function a(o,r){return Object.keys(o).forEach(s=>{s&&o.hasOwnProperty(s)&&(typeof r.key=="object"?o[s]=a(o[s],r[s]):r.hasOwnProperty(s)&&(o[s]=r[s]))}),o}return a({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},e.palette||{})}),l=m(()=>e.cornerActive?" active":""),d=m(()=>({backgroundColor:n.value.bgColor,width:e.thick+"px",height:e.thick+"px",borderRight:`1px solid ${n.value.borderColor}`,borderBottom:`1px solid ${n.value.borderColor}`}));return{paletteCpu:n,cornerActiveClass:l,cornerStyle:d,onCornerClick:a=>{t("onCornerClick",a)}}}}),Re={id:"mb-ruler",class:"style-ruler mb-ruler"};function Ne(e,t,n,l,d,i){const a=A("RulerWrapper");return b(),L("div",Re,[T(a,{vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":e.isShowReferLine,thick:e.thick,ratio:e.ratio,start:e.startX,lines:e.lines.h,"select-start":e.shadow.x,"select-length":e.shadow.width,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),T(a,{vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":e.isShowReferLine,thick:e.thick,ratio:e.ratio,start:e.startY,lines:e.lines.v,"select-start":e.shadow.y,"select-length":e.shadow.height,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),p("a",{class:H(["corner",e.cornerActiveClass]),style:$(e.cornerStyle),onClick:t[0]||(t[0]=(...u)=>e.onCornerClick&&e.onCornerClick(...u))},null,6)])}var P=B(ke,[["render",Ne]]);P.install=e=>{e.component(P.name,P)};const Se=N({setup(e,{expose:t}){t();const n=F({scale:2,startX:0,startY:0,lines:{h:[100,200],v:[100,200]},thick:20}),{scale:l,startX:d,startY:i,lines:a,thick:u}=x(n),o={state:n,scale:l,startX:d,startY:i,lines:a,thick:u,SketchRule:P};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function Le(e,t,n,l,d,i){return b(),W(l.SketchRule,{thick:l.thick,scale:l.scale,width:582,height:482,startX:l.startX,startY:l.startY,lines:l.lines},null,8,["thick","scale","startX","startY","lines"])}var Oe=_(Se,[["render",Le]]);export{Oe as default};
